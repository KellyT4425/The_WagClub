{% extends "base.html" %}
{% load static %}
{% block page_header %}
  <div class="text-center my-4">
    <h2 class="service-page heading">Scan Voucher</h2>
    <p class="text-muted mb-0">Verify and redeem vouchers at check-in.</p>
  </div>
{% endblock page_header %}
{% block content %}
  <div class="voucher-detail-wrapper">
    <div class="wag-voucher-card">
      <div class="voucher-header {% if voucher.status == 'ISSUED' %} issued-bg {% elif voucher.status == 'REDEEMED' %} redeemed-bg {% else %} expired-bg {% endif %}">
        <h3 class="heading mb-0">{{ voucher.service.name }}</h3>
      </div>
      <div class="voucher-body text-center">
        {% if voucher.qr_img_path %}
          <img src="{{ voucher.qr_img_path.url }}"
               alt="QR Code for voucher {{ voucher.code }}"
               class="voucher-qr mb-3">
        {% endif %}
        <p class="mb-1"><strong>Code:</strong> {{ voucher.code }}</p>
        <p class="mb-1"><strong>User:</strong> {{ voucher.user }}</p>
        <p class="mb-1"><strong>Status:</strong>
          {% if voucher.status == "REDEEMED" and voucher.redeemed_at %}
            Redeemed on {{ voucher.redeemed_at|date:"d M Y, H:i" }}
          {% elif voucher.status == "EXPIRED" %}
            Expired
          {% else %}
            Active
          {% endif %}
        </p>
        <p class="mb-3"><strong>Expires:</strong> {{ voucher.expires_at|date:"d M Y" }}</p>

        {% if can_redeem and voucher.status == "ISSUED" %}
          <form method="post" action="{% url 'orders:scan_voucher' voucher.code %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-dark">Redeem Voucher</button>
          </form>
        {% elif voucher.status == "REDEEMED" %}
          <p class="text-success mb-0">Already redeemed.</p>
        {% elif voucher.status == "EXPIRED" %}
          <p class="text-danger mb-0">This voucher has expired.</p>
        {% endif %}

        <div class="text-center mt-4 d-flex flex-wrap justify-content-center gap-2">
          <a href="{% url 'orders:my_wallet' %}" class="btn btn-outline-secondary">Back to Wallet</a>
          <a href="{% url 'orders:voucher_detail' voucher.code %}" class="btn btn-info">View Details</a>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
