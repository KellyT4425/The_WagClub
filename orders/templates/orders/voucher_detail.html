{% extends "base.html" %}
{% load static %}
{% block page_header %}
    <div class="text-center">
        <h2 class="service-page heading">Voucher Details</h2>
    </div>
{% endblock page_header %}
{% block content %}
    <div class="voucher-detail-wrapper">
        <div class="wag-voucher-card">
            <!-- Header bar with status colour -->
            <div class="voucher-header {% if voucher.status == 'ISSUED' %} issued-bg {% elif voucher.status == 'REDEEMED' %} redeemed-bg {% else %} expired-bg {% endif %}">
                <h3 class="heading mb-0">{{ voucher.service.name }} Voucher</h3>
            </div>
            <!-- Body -->
            <div class="voucher-body text-center">
                {% if voucher.qr_img_path %}
                    <img src="{{ voucher.qr_img_path.url }}"
                         alt="QR Code for voucher {{ voucher.code }}"
                         class="voucher-qr">
                {% endif %}
                <p class="voucher-status">
                    <strong>Status:</strong> {{ voucher.status }}
                </p>
                {% if request.user.is_staff and voucher.status == "ISSUED" %}
                    <form method="post" action="{% url 'orders:redeem_voucher' voucher.code %}">
                        {% csrf_token %}
                        <button class="btn btn-dark mt-2">Redeem Voucher</button>
                    </form>
                {% elif voucher.status == "REDEEMED" %}
                    <p class="text-success mt-2 mb-0">This voucher has already been redeemed.</p>
                    {% if voucher.redeemed_at %}
                        <p class="small text-muted mb-0">Redeemed at: {{ voucher.redeemed_at|date:"d M Y, H:i" }}</p>
                    {% endif %}
                {% elif voucher.status == "EXPIRED" %}
                    <p class="text-danger mt-2 mb-0">This voucher has expired.</p>
                {% endif %}
                <hr>
                <div class="text-start mt-3 voucher-details-small">
                    <p>
                        <strong>Voucher Code:</strong> {{ voucher.code }}
                    </p>
                    <p>
                        <strong>Service:</strong> {{ voucher.service }}
                    </p>
                    <p>
                        <strong>Customer:</strong> {{ voucher.user }}
                    </p>
                    <p>
                        <strong>Expires:</strong> {{ voucher.expires_at|date:"d M Y" }}
                    </p>
                </div>
                <div class="text-center mt-4">
                    <a href="{% url 'orders:my_wallet' %}"
                       class="btn btn-secondary me-1 mb-2">‚Üê Back to Wallet</a>
                    <a href="{% url 'orders:voucher_invoice' voucher.code %}"
                       class="btn btn-info me-1 mb-2">View Invoice</a>
                    <button onclick="window.print()" class="btn btn-dark mb-2">Print Voucher</button>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
